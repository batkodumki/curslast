unit UGraphicHint;

interface

uses UFrame,
  Controls,Types,Classes,Graphics,Math;

type
  TGraphicHint = class(THintWindow)
  constructor Create(AOwner: TComponent); override;
  destructor Destroy; override;
  private
    { Private declarations }
  public
    { Public declarations }
    Data:Extended;
    EMF,BalanceEMF,BalanceEMF_,scInteger,scBalanced,scPower,scMaZheng,scDodd: tMetaFile;
    procedure Paint; override;
    function CalcHintRect(MaxWidth: Integer; const AHint: string; AData: Pointer): TRect; override;
  end;

implementation

constructor TGraphicHint.Create(AOwner: TComponent);
begin
  inherited;
  EMF:=TMetafile.Create;
  EMF.Assign(FrameEMF.ImageEMF.Picture);// LoadFromFile('fig.emf');  
//  EMF.Transparent:=false;
  BalanceEMF:=TMetafile.Create;
  BalanceEMF.Assign(FrameEMF.ImageBalanceEMF.Picture);//LoadFromFile('balance.emf');
  BalanceEMF_:=TMetafile.Create;
  BalanceEMF_.Assign(FrameEMF.ImageBalanceEMF_.Picture);//LoadFromFile('balance_.emf');
  scInteger:=TMetafile.Create;
  scInteger.Assign(FrameEMF.ImageInteger.Picture);//LoadFromFile('scInteger.emf');
  scBalanced:=TMetafile.Create;
  scBalanced.Assign(FrameEMF.ImageBalanced.Picture);//LoadFromFile('scBalanced.emf');
  scPower:=TMetafile.Create;
  scPower.Assign(FrameEMF.ImagePower.Picture);//LoadFromFile('scPower.emf');
  scMaZheng:=TMetafile.Create;
  scMaZheng.Assign(FrameEMF.ImageMaZheng.Picture);//LoadFromFile('scMa-Zheng.emf');
  scDodd:=TMetafile.Create;
  scDodd.Assign(FrameEMF.ImageDodd.Picture);//LoadFromFile('scDonegan-Dodd-McMasters.emf');
end;

destructor TGraphicHint.Destroy;
begin
  EMF.Free;
  BalanceEMF.Free;
  BalanceEMF_.Free;
  scInteger.Free;
  scBalanced.Free;
  scPower.Free;
  scMaZheng.Free;
  scDodd.Free;
  inherited;
end;

function TGraphicHint.CalcHintRect(MaxWidth: Integer; const AHint: string; AData: Pointer): TRect;
begin
  Result:=inherited CalcHintRect(MaxWidth, AHint, AData);
  if (AData<>nil) and (Extended(aData^)<>0.0) then begin
    Data:=Extended(aData^);
    Result:=Rect(0,0,250,200)
  end else
    Data:=0.0;
end;//func

procedure TGraphicHint.Paint;
var
  R: TRect;
  Hmemo:integer;
  Data_:Extended;
const
  xe=25; ye=25;  //30 25
begin
  if Data<>0.0 then begin
    Hmemo:=Canvas.Font.Height;
    Canvas.Font.Height:=ClientHeight div 9;
//  Canvas.Font.Color:=clYellow;
//  Canvas.Font.Name:='Arial';
    inherited;
    R := ClientRect;
    with R do begin
      Inc(Left, 2);
      Inc(Top, Canvas.TextHeight(Caption)* 3 div 2);
      if Data<0.0 then begin
        if Data=-1 then
          Canvas.StretchDraw(R,scInteger)
        else if Data=-2 then
          Canvas.StretchDraw(R,scBalanced)
        else if Data=-3 then
          Canvas.StretchDraw(R,scPower)
        else if Data=-4 then
          Canvas.StretchDraw(R,scMaZheng)
        else if Data=-5 then
          Canvas.StretchDraw(R,scDodd)
      end
      else if Data<1 then begin
        Canvas.StretchDraw(R,BalanceEMF_);  // �������� ����
        Data_:=power(1/Data,1/3); // 5 instead 0.5

        Bottom:=ClientRect.Top+ClientHeight * 36 div 37;
        Top:=Bottom - Round(ye*Data_);
        Left:=ClientRect.Right-ClientWidth * 2 div 9 - Round(xe*Data_/2);
        Right:=Left + Round(xe*Data_);
        Canvas.StretchDraw(R,EMF);  // ������ �� ������ ��'���

        Top:=ClientRect.Top+ClientHeight * 7 div 9;
        Bottom:=Top+ye;
        Left:=ClientRect.Left+ClientWidth div 5;
        Right:=Left+xe;
        Canvas.StretchDraw(R,EMF); // ������
      end else begin
        Canvas.StretchDraw(R,BalanceEMF);  // ����
        Data_:=power(Data,1/3);

        Bottom:=ClientRect.Top+ClientHeight * 36 div 37;
        Top:=Bottom-Round(ye*Data_);
        Left:=ClientRect.Left+ClientWidth * 2 div 9 - Round(xe*Data_/2);
        Right:=Left + Round(xe*Data_);
        Canvas.StretchDraw(R,EMF);  // ������ �� ������ ��'���

        Top:=ClientRect.Top+ClientHeight * 7 div 9;
        Bottom:=Top+ye;
        Left:=ClientRect.Right-ClientWidth * 2 div 9;
        Right:=Left+xe;
        Canvas.StretchDraw(R,EMF); // ������
        if Data=1 then begin
          Top:=ClientHeight div 5;
          Bottom:=ClientRect.Bottom - Top;
          Left:=ClientWidth div 3;
          Right:=ClientRect.Right-Left;
          Canvas.Font.Color:=clRed;
          Canvas.Font.Height:=Bottom-Top;
          Canvas.TextRect(R,Left+(Right-Left-Canvas.TextWidth('?'))div 2,Top,'?');
        end;
      end;//else Data<1
    end;
    Canvas.Font.Height:=Hmemo
  end//if Data>0.0
  else
    inherited
end;


end.
